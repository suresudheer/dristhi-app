<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>FormSubmissionRouter.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">app</a> &gt; <a href="index.source.html" class="el_package">org.ei.telemedicine.service.formSubmissionHandler</a> &gt; <span class="el_source">FormSubmissionRouter.java</span></div><h1>FormSubmissionRouter.java</h1><pre class="source lang-java linenums">package org.ei.telemedicine.service.formSubmissionHandler;

import org.apache.commons.lang3.exception.ExceptionUtils;
import org.ei.telemedicine.domain.form.FormSubmission;
import org.ei.telemedicine.repository.FormDataRepository;
import org.ei.telemedicine.util.Log;

import java.util.HashMap;
import java.util.Map;

import static java.text.MessageFormat.format;
import static org.ei.telemedicine.AllConstants.FormNames.*;
import static org.ei.telemedicine.event.Event.FORM_SUBMITTED;
import static org.ei.telemedicine.util.Log.logWarn;


public class FormSubmissionRouter {
    private final Map&lt;String, FormSubmissionHandler&gt; handlerMap;
    private FormDataRepository formDataRepository;

    public FormSubmissionRouter(FormDataRepository formDataRepository,
                                ECRegistrationHandler ecRegistrationHandler,
                                FPComplicationsHandler fpComplicationsHandler,
                                FPChangeHandler fpChangeHandler,
                                RenewFPProductHandler renewFPProductHandler,
                                ECCloseHandler ecCloseHandler,
                                ANCRegistrationHandler ancRegistrationHandler,
                                ANCRegistrationOAHandler ancRegistrationOAHandler,
                                ANCVisitHandler ancVisitHandler,
                                ANCCloseHandler ancCloseHandler,
                                TTHandler ttHandler,
                                IFAHandler ifaHandler,
                                HBTestHandler hbTestHandler,
                                DeliveryOutcomeHandler deliveryOutcomeHandler,
                                PNCRegistrationOAHandler pncRegistrationOAHandler,
                                PNCCloseHandler pncCloseHandler,
                                PNCVisitHandler pncVisitHandler,
                                ChildImmunizationsHandler childImmunizationsHandler,
                                ChildRegistrationECHandler childRegistrationECHandler,
                                ChildRegistrationOAHandler childRegistrationOAHandler,
                                ChildCloseHandler childCloseHandler, ChildIllnessHandler childIllnessHandler,
                                VitaminAHandler vitaminAHandler, DeliveryPlanHandler deliveryPlanHandler,
<span class="fc" id="L43">                                ECEditHandler ecEditHandler, ANCInvestigationsHandler ancInvestigationsHandler,TestSubmissionHandler testSubmissionHandler) {</span>
<span class="fc" id="L44">        this.formDataRepository = formDataRepository;</span>
<span class="fc" id="L45">        handlerMap = new HashMap&lt;String, FormSubmissionHandler&gt;();</span>
<span class="fc" id="L46">        handlerMap.put(EC_REGISTRATION, ecRegistrationHandler);</span>
<span class="fc" id="L47">        handlerMap.put(FP_COMPLICATIONS, fpComplicationsHandler);</span>
<span class="fc" id="L48">        handlerMap.put(FP_CHANGE, fpChangeHandler);</span>
<span class="fc" id="L49">        handlerMap.put(RENEW_FP_PRODUCT, renewFPProductHandler);</span>
<span class="fc" id="L50">        handlerMap.put(EC_CLOSE, ecCloseHandler);</span>
<span class="fc" id="L51">        handlerMap.put(ANC_REGISTRATION, ancRegistrationHandler);</span>
<span class="fc" id="L52">        handlerMap.put(ANC_REGISTRATION_OA, ancRegistrationOAHandler);</span>
<span class="fc" id="L53">        handlerMap.put(ANC_VISIT, ancVisitHandler);</span>
<span class="fc" id="L54">        handlerMap.put(ANC_CLOSE, ancCloseHandler);</span>
<span class="fc" id="L55">        handlerMap.put(TT, ttHandler);</span>
<span class="fc" id="L56">        handlerMap.put(TT_BOOSTER, ttHandler);</span>
<span class="fc" id="L57">        handlerMap.put(TT_1, ttHandler);</span>
<span class="fc" id="L58">        handlerMap.put(TT_2, ttHandler);</span>
<span class="fc" id="L59">        handlerMap.put(IFA, ifaHandler);</span>
<span class="fc" id="L60">        handlerMap.put(HB_TEST, hbTestHandler);</span>
<span class="fc" id="L61">        handlerMap.put(DELIVERY_OUTCOME, deliveryOutcomeHandler);</span>
<span class="fc" id="L62">        handlerMap.put(PNC_REGISTRATION_OA, pncRegistrationOAHandler);</span>
<span class="fc" id="L63">        handlerMap.put(PNC_CLOSE, pncCloseHandler);</span>
<span class="fc" id="L64">        handlerMap.put(PNC_VISIT, pncVisitHandler);</span>
<span class="fc" id="L65">        handlerMap.put(CHILD_IMMUNIZATIONS, childImmunizationsHandler);</span>
<span class="fc" id="L66">        handlerMap.put(CHILD_REGISTRATION_EC, childRegistrationECHandler);</span>
<span class="fc" id="L67">        handlerMap.put(CHILD_REGISTRATION_OA, childRegistrationOAHandler);</span>
<span class="fc" id="L68">        handlerMap.put(CHILD_CLOSE, childCloseHandler);</span>
<span class="fc" id="L69">        handlerMap.put(CHILD_ILLNESS, childIllnessHandler);</span>
<span class="fc" id="L70">        handlerMap.put(VITAMIN_A, vitaminAHandler);</span>
<span class="fc" id="L71">        handlerMap.put(DELIVERY_PLAN, deliveryPlanHandler);</span>
<span class="fc" id="L72">        handlerMap.put(EC_EDIT, ecEditHandler);</span>
<span class="fc" id="L73">        handlerMap.put(ANC_INVESTIGATIONS, ancInvestigationsHandler);</span>
        //New Content
<span class="fc" id="L75">        handlerMap.put(&quot;cus_reg_form&quot;, testSubmissionHandler);</span>
<span class="fc" id="L76">    }</span>

    public void route(String instanceId) throws Exception {
<span class="fc" id="L79">        FormSubmission submission = formDataRepository.fetchFromSubmission(instanceId);</span>
<span class="fc" id="L80">        FormSubmissionHandler handler = handlerMap.get(submission.formName());</span>
<span class="fc bfc" id="L81" title="All 2 branches covered.">        if (handler == null) {</span>
<span class="fc" id="L82">            logWarn(&quot;Could not find a handler due to unknown form submission: &quot; + &quot;submission&quot;);</span>
        } else {
            try {
<span class="fc" id="L85">                handler.handle(submission);</span>
<span class="nc" id="L86">            } catch (Exception e) {</span>
<span class="nc" id="L87">                Log.logError(format(&quot;Handling {0} form submission with instance Id: {1} for entity: {2} failed with exception : {3}&quot;,</span>
                        submission.formName(), submission.instanceId(), submission.entityId(), ExceptionUtils.getStackTrace(e)));
<span class="nc" id="L89">                throw e;</span>
<span class="fc" id="L90">            }</span>
        }
<span class="fc" id="L92">        FORM_SUBMITTED.notifyListeners(instanceId);</span>
<span class="fc" id="L93">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.1.201405082137</span></div></body></html>