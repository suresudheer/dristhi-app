<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>DoctorPatientDetailSuperActivity.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">app</a> &gt; <a href="index.source.html" class="el_package">org.ei.telemedicine.doctor</a> &gt; <span class="el_source">DoctorPatientDetailSuperActivity.java</span></div><h1>DoctorPatientDetailSuperActivity.java</h1><pre class="source lang-java linenums">package org.ei.telemedicine.doctor;

import android.app.Activity;
import android.app.ProgressDialog;
import android.content.Intent;
import android.media.AudioManager;
import android.media.MediaPlayer;
import android.os.AsyncTask;
import android.os.Bundle;
import android.os.Environment;
import android.util.Log;
import android.view.View;
import android.widget.ImageButton;
import android.widget.Toast;

import org.ei.telemedicine.AllConstants;
import org.ei.telemedicine.Context;
import org.ei.telemedicine.R;
import org.ei.telemedicine.event.Listener;
import org.json.JSONArray;
import org.json.JSONException;
import org.json.JSONObject;

import java.io.BufferedInputStream;
import java.io.File;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.io.OutputStream;
import java.net.URL;
import java.net.URLConnection;

import static android.R.drawable.ic_media_pause;
import static org.ei.telemedicine.doctor.DoctorFormDataConstants.formData;

/**
 * Created by naveen on 6/18/15.
 */
<span class="nc" id="L39">public abstract class DoctorPatientDetailSuperActivity extends Activity implements View.OnClickListener {</span>
    private ProgressDialog progressDialog;
    private Bundle bundle;
    private String formInfo, documentId, phoneNumber, caseId;
    private String[] details;
    ProgressDialog playProgressDialog;
    MediaPlayer player;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
<span class="nc" id="L49">        super.onCreate(savedInstanceState);</span>

<span class="nc" id="L51">        bundle = getIntent().getExtras();</span>
<span class="nc bnc" id="L52" title="All 4 branches missed.">        if (bundle != null &amp;&amp; bundle.containsKey(formData)) {</span>

<span class="nc" id="L54">            formInfo = bundle.getString(DoctorFormDataConstants.formData);</span>
<span class="nc" id="L55">            setupViews();</span>
<span class="nc" id="L56">            details = setDatatoViews(formInfo);</span>

<span class="nc bnc" id="L58" title="All 2 branches missed.">            documentId = details[0] != null ? details[0] : &quot;&quot;;</span>
<span class="nc bnc" id="L59" title="All 2 branches missed.">            phoneNumber = details[1] != null ? details[1] : &quot;&quot;;</span>
<span class="nc bnc" id="L60" title="All 2 branches missed.">            caseId = details[2] != null ? details[2] : &quot;&quot;;</span>

        }
<span class="nc" id="L63">    }</span>

    protected abstract String[] setDatatoViews(String formInfo);

    protected abstract void setupViews();

    @Override
    protected void onStop() {
<span class="nc" id="L71">        super.onStop();</span>
<span class="nc bnc" id="L72" title="All 2 branches missed.">        if (player != null) {</span>
<span class="nc" id="L73">            player.release();</span>
        }
<span class="nc" id="L75">    }</span>

    public void pausePlay() {
<span class="nc bnc" id="L78" title="All 2 branches missed.">        if (player != null) {</span>
<span class="nc" id="L79">            player.stop();</span>
<span class="nc" id="L80">            player.release();</span>
        }
<span class="nc" id="L82">    }</span>

    public void playData(String url, final ImageButton ib_play_stehoscope, final ImageButton ib_pause_stehoscope) {
<span class="nc" id="L85">        Log.e(&quot;Play pat&quot;, url);</span>
        try {
<span class="nc" id="L87">            player = new MediaPlayer();</span>
<span class="nc" id="L88">            player.setAudioStreamType(AudioManager.STREAM_MUSIC);</span>
<span class="nc" id="L89">            player.setDataSource(url);</span>
<span class="nc" id="L90">            player.prepare();</span>
//
//            playProgressDialog = new ProgressDialog(DoctorPatientDetailSuperActivity.this);
//            playProgressDialog.setTitle(&quot;Playing Heartbeat&quot;);
////            playProgressDialog.setCancelable(false);
//            playProgressDialog.show();

<span class="nc" id="L97">            player.setOnPreparedListener(new MediaPlayer.OnPreparedListener() {</span>
                @Override
                public void onPrepared(MediaPlayer mp) {
<span class="nc" id="L100">                    mp.start();</span>
<span class="nc" id="L101">                }</span>
            });

<span class="nc" id="L104">            player.setOnCompletionListener(new MediaPlayer.OnCompletionListener() {</span>
                @Override
                public void onCompletion(MediaPlayer mp) {
<span class="nc" id="L107">                    ib_play_stehoscope.setVisibility(View.VISIBLE);</span>
<span class="nc" id="L108">                    ib_pause_stehoscope.setVisibility(View.INVISIBLE);</span>
<span class="nc" id="L109">                }</span>
            });

<span class="nc" id="L112">        } catch (</span>
                IOException e
                )

        {
<span class="nc" id="L117">            e.printStackTrace();</span>
<span class="nc" id="L118">        }</span>
//
//
//        new AsyncTask&lt;String, Void, Boolean&gt;() {
//            @Override
//            protected Boolean doInBackground(String... params) {
//                try {
//
//                } catch (Exception e) {
//                    e.printStackTrace();
//                }
//                return false;
//            }
//
//            @Override
//            protected void onPreExecute() {
//
//
//            }
//
//            @Override
//            protected void onPostExecute(Boolean isRunning) {
//                if (playProgressDialog != null &amp;&amp; !player.isPlaying())
//                    playProgressDialog.dismiss();
//            }
//        }.execute(url);

<span class="nc" id="L145">    }</span>

    public void getVitalsData(final String vitalType, final String visitId) {
<span class="nc" id="L148">        getData(AllConstants.VITALS_INFO_URL_PATH + visitId, new Listener&lt;String&gt;() {</span>
            @Override
            public void onEvent(String data) {
<span class="nc" id="L151">                Log.e(&quot;Result&quot;, visitId);</span>
<span class="nc" id="L152">                Intent intent = new Intent(DoctorPatientDetailSuperActivity.this, NativeGraphActivity.class);</span>
<span class="nc" id="L153">                intent.putExtra(AllConstants.VITALS_INFO_RESULT, data);</span>
<span class="nc" id="L154">                intent.putExtra(AllConstants.VITAL_TYPE, vitalType);</span>
<span class="nc" id="L155">                startActivity(intent);</span>
<span class="nc" id="L156">            }</span>
        });
<span class="nc" id="L158">    }</span>

    public void referAnotherDoctor(String doctorId, final String visitId, String entityId, final String documentId, final String visitType, final String wifeName) {
<span class="nc bnc" id="L161" title="All 2 branches missed.">        getData(AllConstants.DOCTOR_REFER_URL_PATH + doctorId + &quot;&amp;visitid=&quot; + visitId + &quot;&amp;entityid=&quot; + entityId + &quot;&amp;patientname=&quot; + (visitType.equalsIgnoreCase(&quot;CHILD&quot;) ? &quot;Baby%20of%20&quot; + wifeName : wifeName), new Listener&lt;String&gt;() {</span>
            @Override
            public void onEvent(String data) {
<span class="nc" id="L164">                Context.getInstance().allDoctorRepository().deleteUseCaseId(visitId);</span>
<span class="nc" id="L165">                startActivity(new Intent(DoctorPatientDetailSuperActivity.this, NativeDoctorActivity.class).setFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP));</span>

<span class="nc" id="L167">            }</span>
        });

<span class="nc" id="L170">    }</span>


    public void getDrugData() {
<span class="nc" id="L174">        getData(AllConstants.DRUG_INFO_URL_PATH, new Listener&lt;String&gt;() {</span>
            //        getDataFromServer(new Listener&lt;String&gt;() {
            public void onEvent(String resultData) {
<span class="nc bnc" id="L177" title="All 2 branches missed.">                if (resultData != null) {</span>
//                    Toast.makeText(DoctorPatientDetailSuperActivity.this, &quot;Document Id &quot; + documentId, Toast.LENGTH_SHORT).show();
<span class="nc" id="L179">                    Log.e(&quot;Document Id&quot;, documentId);</span>
<span class="nc" id="L180">                    Context.getInstance().allDoctorRepository().updatePocInLocal(documentId, &quot;&quot;, &quot;&quot;);</span>
<span class="nc" id="L181">                    Intent intent = new Intent(DoctorPatientDetailSuperActivity.this, DoctorPlanofCareActivity.class);</span>
<span class="nc" id="L182">                    intent.putExtra(AllConstants.DRUG_INFO_RESULT, resultData);</span>
<span class="nc" id="L183">                    intent.putExtra(DoctorFormDataConstants.formData, formInfo);</span>
<span class="nc" id="L184">                    intent.putExtra(DoctorFormDataConstants.documentId, documentId);</span>
<span class="nc" id="L185">                    intent.putExtra(DoctorFormDataConstants.phoneNumber, phoneNumber);</span>
<span class="nc" id="L186">                    intent.putExtra(DoctorFormDataConstants.anc_entityId, caseId);</span>
<span class="nc" id="L187">                    startActivity(intent);</span>
<span class="nc" id="L188">                } else {</span>
<span class="nc" id="L189">                    Toast.makeText(DoctorPatientDetailSuperActivity.this, &quot;No Data getting from server&quot;, Toast.LENGTH_SHORT).show();</span>
                }
<span class="nc" id="L191">            }</span>
        });
<span class="nc" id="L193">    }</span>

    private void getData(final String url, final Listener&lt;String&gt; afterResult) {
<span class="nc" id="L196">        new AsyncTask&lt;Void, Void, String&gt;() {</span>

            @Override
            protected String doInBackground(Void... params) {
<span class="nc" id="L200">                Context context = Context.getInstance();</span>
<span class="nc" id="L201">                Log.e(&quot;URL&quot;, context.configuration().dristhiDjangoBaseURL() + url);</span>
<span class="nc" id="L202">                String result = context.userService().gettingFromRemoteURL(context.configuration().dristhiDjangoBaseURL() + url);</span>

<span class="nc" id="L204">                return result;</span>
            }

            @Override
            protected void onPreExecute() {
<span class="nc" id="L209">                super.onPreExecute();</span>
<span class="nc" id="L210">                progressDialog = new ProgressDialog(DoctorPatientDetailSuperActivity.this);</span>
<span class="nc" id="L211">                progressDialog.setCancelable(false);</span>
<span class="nc" id="L212">                progressDialog.setMessage(getString(R.string.dialog_message));</span>
<span class="nc" id="L213">                progressDialog.show();</span>
<span class="nc" id="L214">            }</span>

            @Override
            protected void onPostExecute(String resultData) {
<span class="nc" id="L218">                super.onPostExecute(resultData);</span>
<span class="nc bnc" id="L219" title="All 2 branches missed.">                if (progressDialog.isShowing())</span>
<span class="nc" id="L220">                    progressDialog.hide();</span>
<span class="nc" id="L221">                afterResult.onEvent(resultData);</span>
<span class="nc" id="L222">            }</span>
        }.execute();
<span class="nc" id="L224">    }</span>

    public void createFileFrombyte(byte[] audioBytes) {
        try {
<span class="nc" id="L228">            String path = Environment.getExternalStorageDirectory().getAbsolutePath();</span>
<span class="nc" id="L229">            path += &quot;/audiorecordtest.wav&quot;;</span>
<span class="nc" id="L230">            File dstFile = new File(path);</span>
<span class="nc bnc" id="L231" title="All 2 branches missed.">            if (!dstFile.exists())</span>
<span class="nc" id="L232">                dstFile.createNewFile();</span>
<span class="nc" id="L233">            FileOutputStream fout = new FileOutputStream(dstFile);</span>
<span class="nc" id="L234">            fout.write(audioBytes);</span>
<span class="nc" id="L235">            fout.flush();</span>
<span class="nc" id="L236">            fout.close();</span>
<span class="nc" id="L237">        } catch (IOException e) {</span>
<span class="nc" id="L238">            e.printStackTrace();</span>
<span class="nc" id="L239">        }</span>
<span class="nc" id="L240">    }</span>

    public void startPlaying(String path) {
<span class="nc" id="L243">        MediaPlayer mPlayer = new MediaPlayer();</span>
        try {
<span class="nc" id="L245">            mPlayer.setDataSource(path);</span>
<span class="nc" id="L246">            mPlayer.prepare();</span>
<span class="nc" id="L247">            mPlayer.start();</span>
<span class="nc" id="L248">            mPlayer.setOnCompletionListener(new MediaPlayer.OnCompletionListener() {</span>
                @Override
                public void onCompletion(MediaPlayer mp) {
<span class="nc" id="L251">                    mp.stop();</span>
<span class="nc" id="L252">                    mp.release();</span>
<span class="nc" id="L253">                }</span>
            });
<span class="nc" id="L255">        } catch (IOException e) {</span>
<span class="nc" id="L256">            e.printStackTrace();</span>
<span class="nc" id="L257">        }</span>
<span class="nc" id="L258">    }</span>

    public String getDatafromJsonArray(String jsonArrayStr) {
        try {
<span class="nc" id="L262">            String result = &quot;&quot;;</span>
<span class="nc" id="L263">            JSONArray jsonArray = new JSONArray(jsonArrayStr);</span>
<span class="nc bnc" id="L264" title="All 2 branches missed.">            for (int i = 0; i &lt; jsonArray.length(); i++) {</span>
<span class="nc bnc" id="L265" title="All 2 branches missed.">                result = !result.equals(&quot;&quot;) ? result + jsonArray.getString(i).trim().replace(&quot;_&quot;, &quot; &quot;) + &quot;,&quot; : jsonArray.getString(i).trim().replace(&quot;_&quot;, &quot; &quot;) + &quot;,&quot;;</span>
            }
<span class="nc" id="L267">            return result;</span>
<span class="nc" id="L268">        } catch (JSONException e) {</span>
<span class="nc" id="L269">            e.printStackTrace();</span>
        }
<span class="nc" id="L271">        return &quot;&quot;;</span>
    }

    public String getDatafromJson(String jsonStr, String key) {
<span class="nc bnc" id="L275" title="All 2 branches missed.">        if (jsonStr != null) {</span>
            try {
<span class="nc" id="L277">                JSONObject jsonData = new JSONObject(jsonStr);</span>
<span class="nc bnc" id="L278" title="All 6 branches missed.">                return (jsonData.has(key) &amp;&amp; jsonData.getString(key) != null &amp;&amp; !jsonData.getString(key).equalsIgnoreCase(&quot;null&quot;)) ? jsonData.getString(key).trim().replace(&quot; &quot;, &quot;,&quot;).replace(&quot;_&quot;, &quot; &quot;) : &quot;&quot;;</span>
<span class="nc" id="L279">            } catch (JSONException e) {</span>
<span class="nc" id="L280">                e.printStackTrace();</span>
            }
        }
<span class="nc" id="L283">        return &quot;&quot;;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.1.201405082137</span></div></body></html>